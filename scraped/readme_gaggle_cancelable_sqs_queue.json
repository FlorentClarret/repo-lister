"<div class=\"announce instapaper_body md\" data-path=\"README.md\" id=\"file\"><article class=\"markdown-body entry-content\" itemprop=\"text\"><h1><a href=\"#cancelable-sqs-queue\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-cancelable-sqs-queue\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>cancelable-sqs-queue</h1>\n<p>Super simple cancelable distributed queue, based on Amazon SQS.</p>\n<p>Gives you a simple server to manage jobs,\nand any number of workers to process them.\nRun all of it locally\nor distribute the workers across the cloud as you want.</p>\n<h2><a href=\"#getting-started\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-getting-started\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Getting Started</h2>\n<p>Lets do a simple example first.</p>\n<p>Install the module to your project:</p>\n<pre><code>$ npm run install gaggle/cancelable-sqs-queue --save\n</code></pre>\n<p>In terminal A, start the server:</p>\n<pre><code>$ AWS_ACCESS_KEY_ID=&lt;key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret&gt; AWS_SQS_URL=&lt;url&gt; node_modules/.bin/csq-server\n</code></pre>\n<p>In terminal B, start workers:</p>\n<pre><code>$ AWS_ACCESS_KEY_ID=&lt;key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret&gt; AWS_SQS_URL=&lt;url&gt; node_modules/.bin/csq-worker\n</code></pre>\n<p>In terminal C, submit a new job:</p>\n<pre><code>$ curl -X POST -H \"Content-Type: application/json\" -d '{\"key\":\"val\"}' localhost:3000/jobs\n</code></pre>\n<p>You'll see one of the workers immediately process the job.</p>\n<h3><a href=\"#taking-it-further\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-taking-it-further\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Taking It Further</h3>\n<p>Obviously the default worker behavior isn't very exciting,\nthe point is to write your own custom logic.</p>\n<p>First, make a new file:</p>\n<pre><code># worker.js\nvar Worker = require(\"cancelable-sqs-queue/worker\")\n\nvar businesslogic = function (msg) {\n  var data = JSON.parse(msg.Body)\n  console.log(\"Doing magic with\", data)\n}\n\nmodule.exports = function (opts) {\n  return new Worker(businesslogic, opts)\n}\n</code></pre>\n<p>Then, in terminal B, re-start the workers like this (note the <code>-f</code> argument):</p>\n<pre><code>$ AWS_ACCESS_KEY_ID=&lt;key&gt; AWS_SECRET_ACCESS_KEY=&lt;secret&gt; AWS_SQS_URL=&lt;https://sqs.url&gt; node_modules/.bin/csq-worker -f worker.js\n</code></pre>\n<p>That's it. Issue a new job and bask in your custom logic processing.</p>\n<p>Note that you don't have to use the <code>csq-server</code> / <code>csq-worker</code> scripts,\nthey're just provided for convenience.\nFor DIY projects just <code>require</code> the appropriate modules,\ncreate new instances,\nand call <code>.listen()</code>.</p>\n<h3><a href=\"#what-about-canceling\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-what-about-canceling\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What About Canceling?</h3>\n<p>In your function you have access to the worker instance via <code>this</code>,\nand it comes with the helper method <code>this.cancelCheck()</code>.\nRun this at steps in your processing where it makes sense to cancel from,\nand if the job is canceled it'll throw a special exception\nthat informs the system to not process further.</p>\n<p>Note that <code>cancelCheck</code> is a Promise,\nJavascript is asynchronous\nand if your pipeline is complicated enough to warrant canceling\nI think it should be too :).</p>\n<h2><a href=\"#prerequisities\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-prerequisities\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisities</h2>\n<p>You need to have set up an <a href=\"https://www.google.co.uk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjoqK-ih9fMAhVGwiYKHS-WCRgQFggkMAA&amp;url=https%3A%2F%2Faws.amazon.com%2Fsqs%2F&amp;usg=AFQjCNH-cLLezkdRhLruvLVuQGzaTmPdqA\" rel=\"nofollow\">Amazon Simple Queue</a>.\nGrab its url from the dashboard:\n<a href=\"/sqs-dashboard-url.png\" target=\"_blank\"><img src=\"/sqs-dashboard-url.png\" alt=\"SQS dashoard url\" title=\"SQS dashboard url\" style=\"max-width:100%;\"></a></p>\n<p>Pass in AWS credentials via environment variables <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, and <code>AWS_SQS_URL</code>.</p>\n<h3><a href=\"#command-line-arguments\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-command-line-arguments\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Command line arguments</h3>\n<pre><code>$ node_modules/.bin/csq-server -h\nUsage: node_modules/.bin/csq-server [options]\n\nOptions:\n-q, --queue  SQS Queue url (defaults to env AWS_SQS_URL)              [string]\n-p, --port   Port                                     [number] [default: 3000]\n-h, --help   Show help                                               [boolean]\n\n\n$ node_modules/.bin/csq-worker -h\nUsage: node_modules/.bin/csq-worker [options]\n\nOptions:\n  -q, --queue     SQS Queue url (reads env AWS_SQS_URL)                 [string]\n  -s, --server    Server url (reads env SERVER_URL)\n                                     [string] [default: \"http://localhost:3000\"]\n  -f, --function  Path to script that exposes worker function           [string]\n  -c, --count     Number of workers to spawn (defaults to CPU count)\n                                                           [number] [default: 8]\n  -h, --help      Show help                                            [boolean]\n</code></pre>\n<h2><a href=\"#running-the-tests\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-running-the-tests\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running the tests</h2>\n<pre><code>npm run test\n</code></pre>\n<h2><a href=\"#contributing\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-contributing\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contributing</h2>\n<p>Pull-requests welcomed! Keep the code clean and tests passing.</p>\n<p>Create issues for any suggestions or bugs.</p>\n<h2><a href=\"#license\" aria-hidden=\"true\" class=\"anchor\" id=\"user-content-license\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>License</h2>\n<p>Licensed under the MIT License - see <a href=\"LICENSE\">LICENSE</a> for details</p>\n</article></div>"